<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#2c4a6e">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>sky gallery</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono:wght@400;500;600;700;800;900&family=Tomorrow:wght@400;800&family=Quantico:wght@400;500;800&display=swap"
    rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Background on document root so it fills the screen on iOS (including behind Dynamic Island / Safari bar) */
    html {
      scroll-behavior: smooth;
      min-height: 100%;
      height: 100%;
      /* min-height: -webkit-fill-available; */
      background-size: cover;
      background-position: center center;
      background-repeat: no-repeat;
      background-image: url('background.png');
      overscroll-behavior: none;
      -webkit-text-size-adjust: 100%;
      -webkit-tap-highlight-color: transparent;
      -webkit-overflow-scrolling: touch;
    }

    html::before {
      content: '';
      position: fixed;
      top: calc(-1 * env(safe-area-inset-top, 0px) - 60px);
      left: calc(-1 * env(safe-area-inset-left, 0px));
      right: calc(-1 * env(safe-area-inset-right, 0px));
      bottom: calc(-1 * env(safe-area-inset-bottom, 0px) - 120px);
      z-index: -1;
      background-color: #8095B8;
    }

    body {
      font-family: 'Share Tech Mono', sans-serif;
      overflow-x: hidden;
      overflow-y: scroll;
      -webkit-overflow-scrolling: touch;
      height: 100%;
      min-height: 100%;
      /* min-height: -webkit-fill-available; */
      background-color: #8095B8;
      position: relative;
    }

    /* Fallback fixed layer (matches html::before) in case pseudo-element is clipped on some browsers */
    .page-bg {
      position: fixed;
      top: calc(-1 * env(safe-area-inset-top, 0px) - 60px);
      left: calc(-1 * env(safe-area-inset-left, 0px));
      right: calc(-1 * env(safe-area-inset-right, 0px));
      bottom: calc(-1 * env(safe-area-inset-bottom, 0px) - 120px);
      z-index: -2;
      background-color: #8095B8;
    }

    /* Tall scroll container - 500% viewport so we have 5 scroll phases */
    .scroll-trigger {
      height: 500dvh;
      position: relative;
    }

    /* Sticky viewport - extends into safe areas so text and background fill top/bottom (Dynamic Island, Safari bar) */
    /* Sticky viewport - height set in JS to window.innerHeight so it fills exactly one screen and stays visible while scrolling */
    .viewport {
      position: sticky;
      top: 0;
      left: 0;
      width: 100%;
      height: 100dvh;
      /* min-height: -webkit-fill-available; */
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transform: translateZ(0);
      will-change: scroll-position;
      contain: layout style;
    }

    /* Background layer for viewport (scrolls with transform); fills full viewport including safe areas */
    .viewport-bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 150%;
      min-height: 150%;
      /* min-height: -webkit-fill-available; */
      z-index: 0;
      will-change: transform;
      background-size: cover;
      background-position: center center;
      background-repeat: no-repeat;
      background-image: url('background.png');
      transform: translateY(calc(var(--bg-y-px, 0) * -1px));
    }

    /* Overlay for better text readability */
    .viewport::after {
      content: '';
      position: absolute;
      inset: 0;
      z-index: 2;
      background: linear-gradient(to bottom,
          rgba(0, 0, 0, 0.15) 0%,
          transparent 20%,
          transparent 80%,
          rgba(0, 0, 0, 0.2) 100%);
      pointer-events: none;
    }

    .line {
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      overflow: hidden;
      transition: none;
      flex-shrink: 0;
      padding-left: 4vw;
      padding-top: 0;
      padding-bottom: 0;
      margin-bottom: -1.5vh;
      contain: layout;
    }

    .line:last-child {
      margin-bottom: 0;
    }

    .line span {
      font-weight: 500;
      color: #fff;
      letter-spacing: -0.01em;
      white-space: nowrap;
      line-height: 0;
      transform-origin: left center;
    }

    /* Heights driven by CSS variables from JS */
    .line-1 {
      height: var(--h1, 0%);
      /* padding-top: 5vw; */
    }

    .line-2 {
      height: var(--h2, 100%);
      padding-bottom: calc(var(--h2-num, 0) * 0.08vh);
      padding-left: 2.5vw;
    }

    .line-3 {
      height: var(--h3, 0%);
    }

    .line-4 {
      height: var(--h4, 0%);
    }

    .line-5 {
      height: var(--h5, 0%);
    }

    .line-6 {
      height: var(--h6, 0%);
    }

    /* Static width (font-size in vw); dynamic height via scaleY so text fills 80% of row */
    .line-1 span {
      font-size: 4vw;
      transform: scaleY(calc((var(--h1-num, 0) * 1vh) / (5 * 1vw)));
    }

    .line-2 span {
      font-family: 'Tomorrow', sans-serif;
      font-weight: 300;
      font-size: 20vw;
      transform: scaleY(calc((var(--h2-num, 0) * 1vh) / (17 * 1vw)));
    }

    .line-3 span {
      font-size: 4vw;
      transform: scaleY(calc((var(--h3-num, 0) * 1vh) / (5 * 1vw)));
    }

    .line-4 span {
      font-size: 4vw;
      transform: scaleY(calc((var(--h4-num, 0) * 1vh) / (5 * 1vw)));
    }

    .line-5 span {
      font-size: 4vw;
      transform: scaleY(calc((var(--h5-num, 0) * 1vh) / (5 * 1vw)));
    }

    .line-6 span {
      font-size: 4vw;
      transform: scaleY(calc((var(--h6-num, 0) * 1vh) / (5 * 1vw)));
    }

    /* Bottom-right info block: only visible when scrolled to bottom, slides up from below */
    .bottom-info {
      position: fixed;
      bottom: calc(1.5rem + env(safe-area-inset-bottom, 0px));
      right: calc(1.5rem + env(safe-area-inset-right, 0px));
      left: auto;
      text-align: right;
      z-index: 10;
      font-family: 'Quantico', sans-serif;
      font-size: clamp(0.75rem, 2.5vw, 1rem);
      color: #fff;
      line-height: 1.5;
      opacity: 0;
      pointer-events: none;
      transform: translateY(1.5rem);
      transition: opacity 0.4s ease, transform 0.5s ease;
    }

    .bottom-info.visible {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    .bottom-info a {
      display: block;
      color: #fff;
      font-weight: 500;
      text-decoration: none;
      background: #e53935;
      padding: 0.25em 0 0.25em 0.75em;
      margin-right: calc(-1 * (1.5rem + env(safe-area-inset-right, 0px)));
      padding-right: calc(1.5rem + env(safe-area-inset-right, 0px));
      margin-top: 0.25em;
    }

    .bottom-info a:hover {
      text-decoration: underline;
    }
  </style>
</head>

<body>
  <div class="page-bg" aria-hidden="true"></div>
  <div class="bottom-info" id="bottom-info">
    where: TBD!<br>
    when: TBD!<br>
    <a href="https://forms.gle/b7pXFVxRciBeQtnp6">artist submissions</a>
  </div>
  <div class="scroll-trigger">
    <div class="viewport" id="viewport">
      <div class="viewport-bg" aria-hidden="true"></div>
      <div class="line line-1"><span>the</span></div>
      <div class="line line-2"><span>SKY</span></div>
      <div class="line line-3"><span>which leaves</span></div>
      <div class="line line-4"><span>beneath it</span></div>
      <div class="line line-5"><span>a sea of</span></div>
      <div class="line line-6"><span>beauty.</span></div>
    </div>
  </div>

  <script>
    const viewport = document.getElementById('viewport');

    var scrollTrigger = document.querySelector('.scroll-trigger');

    // Each keyframe: heights as % of viewport; bgY = background image position Y (5% per keyframe)
    const keyframes = [
      { h1: 0, h2: 90, h3: 0, h4: 0, h5: 0, h6: 0, bgY: 0 },  // 0%
      { h1: 10, h2: 80, h3: 10, h4: 0, h5: 0, h6: 0, bgY: 10 },  // 20%
      { h1: 5, h2: 70, h3: 5, h4: 20, h5: 0, h6: 0, bgY: 20 },  // 40%
      { h1: 5, h2: 60, h3: 5, h4: 5, h5: 25, h6: 0, bgY: 30 },  // 60%
      { h1: 5, h2: 50, h3: 5, h4: 5, h5: 5, h6: 30, bgY: 40 }, // 80%
      { h1: 5, h2: 20, h3: 5, h4: 5, h5: 5, h6: 5, bgY: 50 }   // 100%
    ];


    function lerp(a, b, t) {
      return a + (b - a) * t;
    }

    function getScrollPhase() {
      const trigger = document.querySelector('.scroll-trigger');
      const scrollTop = window.scrollY || document.documentElement.scrollTop;
      const totalScroll = trigger.offsetHeight - window.innerHeight;
      if (totalScroll <= 0) return 0;
      const p = Math.min(1, scrollTop / totalScroll);
      return p; // 0 to 1
    }

    function getInterpolatedKeyframe(phase) {
      // phase is 0..1, we have 6 keyframes at 0, 0.2, 0.4, 0.6, 0.8, 1.0
      if (phase >= 1) return keyframes[5];
      const segments = 5;
      const segmentIndex = Math.min(Math.floor(phase * segments), segments - 1);
      const segmentT = (phase * segments) - segmentIndex;
      const k1 = keyframes[segmentIndex];
      const k2 = keyframes[segmentIndex + 1];
      return {
        h1: lerp(k1.h1, k2.h1, segmentT),
        h2: lerp(k1.h2, k2.h2, segmentT),
        h3: lerp(k1.h3, k2.h3, segmentT),
        h4: lerp(k1.h4, k2.h4, segmentT),
        h5: lerp(k1.h5, k2.h5, segmentT),
        h6: lerp(k1.h6, k2.h6, segmentT),
        bgY: lerp(k1.bgY, k2.bgY, segmentT)
      };
    }

    function updateHeights() {
      // setViewportHeight();
      const phase = getScrollPhase();
      const bottomInfo = document.getElementById('bottom-info');
      if (bottomInfo) {
        bottomInfo.classList.toggle('visible', phase >= 0.95);
      }
      const k = getInterpolatedKeyframe(phase);
      ['1', '2', '3', '4', '5', '6'].forEach(i => {
        const h = k['h' + i];
        viewport.style.setProperty('--h' + i, h + '%');
        viewport.style.setProperty('--h' + i + '-num', h);
      });
      var maxMovePx = 0.5 * window.innerHeight;
      viewport.style.setProperty('--bg-y-px', (k.bgY / 50) * maxMovePx);
    }

    var lastScrollTop = -1;
    var lastPhase = -1;
    function tick() {
      var scrollTop = window.scrollY || document.documentElement.scrollTop;
      var phase = getScrollPhase();
      if (Math.abs(scrollTop - lastScrollTop) > 2 || Math.abs(phase - lastPhase) > 0.002) {
        lastScrollTop = scrollTop;
        lastPhase = phase;
        updateHeights();
      }
      requestAnimationFrame(tick);
    }
    window.scrollTo(0, 0);
    requestAnimationFrame(tick);
    window.addEventListener('resize', updateHeights);
    window.addEventListener('scroll', function () { updateHeights(); }, { passive: true });
    window.addEventListener('orientationchange', function () { setTimeout(updateHeights, 100); });
  </script>
</body>

</html>
